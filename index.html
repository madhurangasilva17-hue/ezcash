<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EzCash</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#f4f6fb}
.container{padding:16px}
.card{background:#fff;padding:20px;border-radius:20px;margin-bottom:16px}
.amount{font-size:24px;font-weight:bold;color:#1e88e5}
.btn{width:100%;padding:14px;background:#1e88e5;color:#fff;border:none;border-radius:12px;margin-top:10px;font-weight:600}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h2 id="username">Welcome</h2>
<p>Total Earnings</p>
<div class="amount" id="balance">0.00 LKR</div>
</div>

<div class="card">
<p>Referrals</p>
<div class="amount" id="referrals">0</div>
<button class="btn" onclick="copyRef()">Copy Referral Link</button>
</div>

<div class="card">
<p>Daily Ads</p>
<div id="adsCount">0 / 30</div>
<button class="btn" onclick="watchAd()">Watch Ad (+100)</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const API_URL = "https://ezcash-1.onrender.com";

let user = tg.initDataUnsafe?.user;

async function loadUser(){
  const res = await fetch(API_URL + "/user/" + user.id);
  const data = await res.json();

  document.getElementById("balance").innerText =
    data.balance.toFixed(2) + " LKR";

  document.getElementById("referrals").innerText =
    data.referrals;

  document.getElementById("adsCount").innerText =
    data.ads + " / 30";
}

async function watchAd(){

  window.open("https://www.effectivegatecpm.com/axeeyqg3tf?key=b80fe1d68675c8ba9e9127836a0c430b");

  setTimeout(async ()=>{
    await fetch(API_URL + "/reward?userid=" + user.id);
    await loadUser();
  }, 15000);
}

function copyRef(){
  const link = "https://t.me/ezcash_lk_bot?start=" + user.id;
  navigator.clipboard.writeText(link);
  alert("Copied âœ…");
}

document.getElementById("username").innerText =
  "Welcome, " + user.first_name;

loadUser();

// ðŸ”¥ AUTO LIVE UPDATE EVERY 5 SECONDS
setInterval(loadUser, 5000);

</script>

</body>
</html>
