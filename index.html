const TelegramBot = require("node-telegram-bot-api");
const express = require("express");
const cors = require("cors");

const token = "PASTE_NEW_BOT_TOKEN_HERE";
const WEBAPP_URL = "https://YOUR_GITHUB_USERNAME.github.io/YOUR_REPO_NAME/";

const bot = new TelegramBot(token, { polling: true });

const app = express();
app.use(cors());
app.use(express.json());

let users = {};

bot.onText(/\/start(?: (.+))?/, (msg, match) => {
  const userId = msg.from.id;
  const refId = match[1];

  if (!users[userId]) {
    users[userId] = { balance: 0, referrals: 0, ads: 0 };

    if (refId && refId != userId && users[refId]) {
      users[refId].balance += 200;
      users[refId].referrals += 1;
    }
  }

  bot.sendMessage(msg.chat.id, "EzCash à·€à·™à¶­ à·ƒà·à¶¯à¶»à¶ºà·™à¶±à·Š à¶´à·’à·…à·’à¶œà¶±à·’à¶¸à·” ðŸ’°", {
    reply_markup: {
      inline_keyboard: [[
        { text: "à¶‡à¶´à·Š à¶‘à¶š à·€à·’à·€à·˜à¶­ à¶šà¶»à¶±à·Šà¶±", web_app: { url: WEBAPP_URL } }
      ]]
    }
  });
});

app.post("/watch-ad", (req, res) => {
  const { userId } = req.body;
  if (!users[userId]) return res.json({ error: "User not found" });

  if (users[userId].ads >= 30)
    return res.json({ error: "à¶…à¶¯ à¶¯à·à¶±à·Šà·€à·“à¶¸à·Š à·ƒà·“à¶¸à·à·€ à·ƒà¶¸à·Šà¶´à·–à¶»à·Šà¶«à¶ºà·’" });

  users[userId].balance += 100;
  users[userId].ads += 1;

  res.json({ balance: users[userId].balance });
});

app.listen(3000, () => {
  console.log("Server running on port 3000");
});
